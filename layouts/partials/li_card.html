{{ $item := . }}


{{/* Dynamic view adjusts to content type. */}}
{{ $show_buttons := false }}
{{ if eq $item.Type "courses" }}
  {{ $show_buttons = true }}
{{ else if eq $item.Type "publication" }}
  {{ $show_buttons = true }}
{{ end }}

{{/* Get summary. */}}
{{ $summary := "" }}
{{ if $item.Params.summary }}
  {{ $summary = $item.Params.summary | markdownify | emojify }}
{{ else if .Params.abstract }}
  {{ $summary = .Params.abstract | markdownify | emojify }}
{{ else if $item.Summary }}
  {{ $summary = $item.Summary }}
{{ end }}

<div class="card-simple">

  {{ if eq $item.Type "courses" }}
  <div class="article-metadata">
    <span>
      {{ partial "functions/get_course_dates" $item }}
    </span>
    {{ with $item.Params.location }}
    <span class="middot-divider"></span>
    <span>{{ . }}</span>
    {{ end }}
  </div>
  {{ else }}
    {{ partial "page_metadata" (dict "page" $item "is_list" 1) }}
  {{ end }}

  {{ $resource := ($item.Resources.ByType "image").GetMatch "*featured*" }}
  {{ $anchor := $item.Params.image.focal_point | default "Smart" }}
  {{ with $resource }}
  {{ $image := .Fill (printf "918x517 q90 %s" $anchor) }}
  <a href="{{ $item.RelPermalink }}">
      <img src="{{ $image.RelPermalink }}" class="article-banner" alt="">
  </a>
  {{end}}

  <details>
    <summary>{{ $item.Title }}</summary>
    <div class="row">
      <div class="col-lg-6">
        <div id="instructors">
          <h3><i class="fas fa-graduation-cap"></i> {{ i18n "instructors" }}</h3>
          <ul class="ul-edu fa-ul">
            {{ range $index, $instructor := $item.Params.instructors }}
            <li>
              <i class="fa-li fas fa-user-alt"></i>
              <div class="description">
                <p class="instructor">{{ $instructor.name }}
                {{ if $instructor.email }}
                : <a href='mailto:{{ $instructor.email }}?subject=PIMS Course registration enquiry : {{ $item.Title }}'>{{ $instructor.email }} <i class="fa fa-envelope" aria-hidden="true"></i></a>
                {{ end }}
                <p class="institution">{{ $instructor.institution }}</p>
              </div>
            </li>
            {{ end }}
          </ul>
        </div>
        <div id="prerequisites">
          <h3><i class="fas fa-list"></i> {{ i18n "prerequisites" }}</h3>
          <ul class="ul-edu fa-ul">
            {{ range $index, $prereq := $item.Params.prerequisites }}
            <li>
              <i class="fa-li fas fa-check"></i>
              <div class="description">
                <p class="prerequisite">{{ $prereq }}</p>
              </div>
            </li>
            {{ end }}
          </ul>
        </div>
      </div>
      <div class="col-lg-6">
        <h3><i class="fas fa-sign-in-alt"></i> Registration</h3>
          <div class="article-style">
            {{ if $item.Params.registration_open }}
            <p>This course is available for registration under the Western
            Dean's Agreement but registrations must be approved by the course
            instructor. Please contact the instructor (using the email link to
            the left) including details of how you meet the course
            prerequisites.
            Following that, you must complete the <a target="_blank"
            href="http://wcdgs.ca/content/dam/ex/wcdgs/Western-Deans-Agreement.pdf">Western
          Deans' Agreement form  <i class="fas fa-file-pdf"
            aria-hidden="true"></i></a>, using the course details below.  The
            completed form should be returned to your graduate advisor who will
            sign it and take the required steps. For students at PIMS sites,
            see the bottom of this page for a <a href="/#wda">list of the
              current graduate advisors</i></a>, contacts for other sites can
          be found on the <a target="_blank"
    href="http://wcdgs.ca/contact-us.html">Western Deans' Agreement contact
    page <i class="fas fa-external-link-alt"></i></a>.</p> 
            <div class="row">
              <div class="col-lg-12">
                <dl class="row">
                  <dt class="col-sm-4">Course Name</dt>
                  <dd class="col-sm-8">{{ $item.Params.course_title }}</dd>
                  <dt class="col-sm-4">Course Number</dt>
                  <dd class="col-sm-8">{{ $item.Params.course_number }}</dd>
                  <dt class="col-sm-4">Section Number</dt>
                  <dd class="col-sm-8">{{ $item.Params.section_number }}</dd>
                  <dt class="col-sm-4">Section Code</dt>
                  <dd class="col-sm-8">{{ $item.Params.section_code }}</dd>
                </dl>
              </div>
            </div>
            <p>The Western Deans' Agreement provides an automatic tuition fee
            waiver for visiting students. Graduate students paying normal
            required tuition fees at their home institution will not pay
            tuition fees to the host institution. However, students may be
            required to pay other ancillary fees to the host institution, or
            explicitly request exemptions from some items (e.g. Insurance or
            travel fees).  For help with completing the Western Deanâ€™s
            agreement form, please contact the graduate student advisor
            at your institution. For more information about the
            agreement, please see the <a target="_blank"
            href="http://wcdgs.ca/western-deans-agreement.html">Western Dean's
            Agreement website <i class="fas fa-external-link-alt"></i></a>.</p>
            {{ else }} <p>Registration for this course is no longer
            available.</p> {{ end }}
          </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <h2>{{ i18n "abstract" }}</h2>
        {{ with $item.Params.abstract }}
        <div class="article-style">
          <p>{{ . | markdownify }}</p>
        </div>
        {{end}}
        {{ if $item.Params.syllabus_txt }}
          <h2>{{ i18n "syllabus" }}</h2>
          {{ with $item.Params.syllabus_txt }}
          <div class="article-style">
            <p>{{ . | markdownify }}</p>
          </div>
          {{ end }}
        {{ else if $item.Params.syllabus_pdf }}
          <h2>{{ i18n "syllabus" }}</h2>
          {{ with $item.Params.syllabus_pdf }}
          <div class="article_style">
            {{ $resource := $item.Resources.GetMatch "*.pdf" }}
            <a href="{{ path.Join $item.RelPermalink . | relURL }}" target="_blank" rel="noopener">{{ . }} <i class="fas fa-file-pdf"></i></a>
          </div>
          {{ end }}
        {{ end }}
        <h2>{{ i18n "otherinfo" }}</h2>
        {{ with $item.Content }}
        <div class="article-style">
          <p>{{ . | markdownify }}</p>
        </div>
        {{ end }}
      </div>
    </div>

  </details>
  {{ if $show_buttons }}
  <div class="btn-links">
    {{ partial "page_links" (dict "page" $item "is_list" 1) }}
  </div>
  {{ end }}
  {{ if $item.Params.instructors }}
  <div class="article-metadata-footer">
  <div>
    {{ range $index, $instructor := $item.Params.instructors }}
    {{- if gt $index 0 }}, {{ end -}}
    <span>{{ $instructor.name }} ({{ $instructor.institution }})</span>
    {{ end }}
  </div>
  </div>
  {{ end }}

</div>
